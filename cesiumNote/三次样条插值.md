# 三次样条插值

对于一个区间(a,b)，将区间分成$x_0 = a < x_1 \cdots x_{n-1} < b = x_n$的$n-1$个区间。

需要通过已知的$n+1$个点来模拟一个未知的函数，在三次样条插值中采用**分段**的方法来做这件事。

三次样条插值得到的分段函数保证以下条件成立，而这些条件也是用来求解每一段样条插值的条件：<br>
1.模拟出来的函数在已知点的函数值等于f的函数值<br> 
2.模拟出来的分段函数是二阶连续的也就是说导数和二阶导数在分段的交界点是相等的<br>
3.需要知道在$a$和$b$点的二阶导数的情况，或者二阶导数在这$n+1$个点的变化规律。

内在规律，已知：<br>
1.$n+1$个数据点$[x_i,y_i]$，$i=0,1, \cdots ,n$<br> 
2.每一分段都是三次多项式函数曲线<br> 
3.节点达到二阶连续<br> 
4.左右两端点特性（自然边界，固定边界，非节点边界）

插值和连续性
$$S_i(x_i)=y_i$$
$$S_i(x_{i+1})=y_{i+1}，其中i=0,1, \cdots , n-1$$

微分连续性：
$$S_i^{'}(x_{i+1})=S_{i+1}^{'}(x_{i+1})$$
$$S_i^{''}(x_{i+1})=S_{i+1}^{''}(x_{i+1})，其中i=0,1, \cdots , n-2$$

样条曲线的微分式
$$S_i(x)=a_i+b_i(x-x_i)+c_i(x-x_i)^2+d_i(x-x_i)^3$$
$$S_i^{'}(x)=b_i+2c_i(x-x_i)+3d_i(x-x_i)^2$$
$$S_i^{''}(x)=2c_i+6d_i(x-x_i)$$


将步长$h_i=x_{i+1}-x_i$代入样条曲线的条件：<br> 
a.由$S_i(x_i)=y_i(i=0,1, \cdots ,n-1)$推出$$a_i=y_i$$
b.由$S_i(x_{i+1})=y_{i+1}(i=0,1, \cdots ,n-1)$推出$$a_i+h_ib_i+h_i^2c_i+h_i^3d_i=y_{i+1}$$
c.由$S_i^{'}(x_{i+1})=S_{i+1}^{'}(x_{i+1})(i=0,1, \cdots ,n-2)$推出$$S_i^{'}(x_{i+1})=b_i+2c_i(x_{i+1}-x{i})+3d_i(x_{i+1}-x{i})^2=b_{i}+2c_ih+3d_ih^2$$
$$S_{i+1}^{'}(x_{i+1})=b_{i+1}+2c_i(x_{i+1}-x{i+1})+3d_i(x_{i+1}-x{i+1})^2=b_{i+1}$$
由此可得：
$$b_i+2h_ic_i+3h_i^2d_i-b_{i+1}=0$$
d.由$S_i^{''}(x_{i+1})=S_{i+1}^{''}(x_{i+1})(i=0,1, \cdots , n-2)$推出$$2c_i+6h_id_i-2c_{i+1}=0$$

设$m_i=S_i^{''}(x_i)=2c_i$，则<br> 
a.$2c_i+6h_id_i-2c_{i+1}=0$可写为$m_i+6h_id_i-m_{i+1}=0$，推出$$d_i=\frac{m_{i+1}-m_i}{6h_i}$$
b.将$b_i,c_i,d_i$代入$b_i+2h_ic_i+3h_i^2d_i=b_{i+1}(i=0,1, \cdots ,n-2)$可得：$$h_im_i+2(h_i+h_{i+1})m_{i+1}+h_{i+1}m_{i+2}=6[\frac{y_{i+2}-y_{i+1}}{h_{i+1}}-\frac{y_{i+1}-y_i}{h_i}]$$

### 端点条件
由$i$的取值范围可知，共有$n-1$个公式，但却有$n+1$个未知量$m$。<br>
要求解，需要对两端点$x_0$和$x_n$的微分加以限制。

3种比较常用的限制如下:

#### 自由边界
首尾两端没有受到任何让它们弯曲的力，即$S^{''}=0$。具体表示为$m_0=0,m_n=0$<br> 
则要求解的方程组可写为：![natural](https://images0.cnblogs.com/blog/477176/201301/26192741-c629f65d48af4a07912bb6b2fbdad544.png)

#### 固定边界
首尾两端点的微分值是被指定的，这里分别定位A和B，则可以推出
$$S_0^{'}(x_0)=A\ \ ==>\ \ b_0=A$$
$$\ \ \ \ \ \ ==>\ \ A=\frac{y_1-y_0}{h_0}-\frac{h_0}{2}m_0-\frac{h_0}{6}(m_1-m_0)$$
$$\ \ \ \ \ \ ==>\ \ 2h_0m_0+h_0m_1=6[\frac{y_1-y_0}{h_0}-A]$$

$$S_{n-1}^{'}(x_n)=B\ \ ==>\ \ b_{n-1}=B$$
$$\ \ \ \ \ \ ==>\ \ 2h_{n-1}m_{n-1}+h_{n-1}m_n=6[B-\frac{y_n-y_{n-1}}{h_{n-1}}]$$

将上述两个公式代入方程组，新的方程组左侧为：<br> 
![clamped](https://images0.cnblogs.com/blog/477176/201301/26192820-55ebf1fc6208489cb6fcead05d2c0a68.png)

#### 非节点边界
指定样本曲线的三次微分匹配，则$$S_0^{'''}(x_1)=S_1^{'''}(x_1)$$
$$S_{n-2}^{'''}(x_{n-1})=S_{n-1}^{'''}(x_{n-1})$$
根据$S_i^{'''}(x)=6d_i$和$d_i=\frac{m_{i+1}-m_i}{6h_i}$，则上述条件变为
$$h_1(m_1-m_0)=h_0(m_2-m_1)$$
$$h_{n-1}(m_{n-1}-m_{n-2})=h_{n-2}(m_n-m_{n-1})$$

新的方程组系数矩阵可写为：<br> 
![not_a_knot](https://images0.cnblogs.com/blog/477176/201301/26192906-b27346b8322e46d6a9546a440b0fe5cc.png)

### 总结
假定有$n+1$个数据节点
$$(x_0,y_0),(x_1,y_1), \cdots , (x_n,y_n)$$

a.计算步长$h_i=x_{i+1}-x_i(i=0,1, \cdots ,n-1)$<br> 
b.将数据节点和指定的首位端点条件代入矩阵方程<br> 
c.解矩阵方程，求得二次微分值$m_i$。该矩阵为三对角矩阵。<br> 
d.计算样条曲线的系数：$$a_i=y_i$$ $$b_i=\frac{y_{i+1}-y_i}{h_i}-\frac{h_i}{2}m_i-\frac{h_i}{6}(m_{i+1}-m_i)$$ $$c_i=\frac{m_i}{2}$$ $$d_i=\frac{m_{i+1}-m_i}{6h_i}$$
e.在每个子区间$x_i<=x<=x_{i+1}$中，创建方程$$g_i(x)=a_i+b_i(x-x_i)+c_i(x-x_i)^2+d_i(x-x_i)^3$$